{
    "docs": [
        {
            "location": "/",
            "text": "Welcome to anasme's doc !\n\u00b6\n\n\nCe site est consacr\u00e9 \u00e0 ma doc orient\u00e9 devops et AdminSYS principalement.\n\n\nN'h\u00e9sitez pas \u00e0 me contacter ou \u00e0 contribuer \n\n\nBonne navigation !\n\n\n\n\nAnas Asmi.",
            "title": "Welcome to anasme's doc !"
        },
        {
            "location": "/#welcome-to-anasmes-doc",
            "text": "Ce site est consacr\u00e9 \u00e0 ma doc orient\u00e9 devops et AdminSYS principalement.  N'h\u00e9sitez pas \u00e0 me contacter ou \u00e0 contribuer   Bonne navigation !   Anas Asmi.",
            "title": "Welcome to anasme's doc !"
        },
        {
            "location": "/AdminSys/hardening/",
            "text": "",
            "title": "Hardening"
        },
        {
            "location": "/AdminSys/BDD/Environnement R\u00e9seau/",
            "text": "Environnement r\u00e9seau\n\u00b6\n\n\nImportant\n\u00b6\n\n\nLa base de donn\u00e9 est un \u00e9lement critique et sensible d'un architecture pour ces 2 raisons:\n\n\n\n\n\n\nIl n'est pas con\u00e7u pour se prot\u00e9ger efficacement des attaques\n\n\nil contient des donn\u00e9es, c'est \u00e0 dire la seule information p\u00e9renne dans notre architecture\n\n\n\n\n\n\nC'est pour cela qu'il faut l'isoler au maximum :\n \n\n\n\u00e0 ne pas faire\n\u00b6\n\n\n\n\n\u00e0 ne pas faire non plus\n\u00b6\n\n\n\n\nbien de faire\n\u00b6\n\n\n\n\nmeilleur chose \u00e0 faire\n\u00b6",
            "title": "Environnement r\u00e9seau"
        },
        {
            "location": "/AdminSys/BDD/Environnement R\u00e9seau/#environnement-reseau",
            "text": "",
            "title": "Environnement r\u00e9seau"
        },
        {
            "location": "/AdminSys/BDD/Environnement R\u00e9seau/#important",
            "text": "La base de donn\u00e9 est un \u00e9lement critique et sensible d'un architecture pour ces 2 raisons:    Il n'est pas con\u00e7u pour se prot\u00e9ger efficacement des attaques  il contient des donn\u00e9es, c'est \u00e0 dire la seule information p\u00e9renne dans notre architecture    C'est pour cela qu'il faut l'isoler au maximum :",
            "title": "Important"
        },
        {
            "location": "/AdminSys/BDD/Environnement R\u00e9seau/#a-ne-pas-faire",
            "text": "",
            "title": "\u00e0 ne pas faire"
        },
        {
            "location": "/AdminSys/BDD/Environnement R\u00e9seau/#a-ne-pas-faire-non-plus",
            "text": "",
            "title": "\u00e0 ne pas faire non plus"
        },
        {
            "location": "/AdminSys/BDD/Environnement R\u00e9seau/#bien-de-faire",
            "text": "",
            "title": "bien de faire"
        },
        {
            "location": "/AdminSys/BDD/Environnement R\u00e9seau/#meilleur-chose-a-faire",
            "text": "",
            "title": "meilleur chose \u00e0 faire"
        },
        {
            "location": "/AdminSys/BDD/MySQL/",
            "text": "MYSQL\n\u00b6\n\n\nLe fichier de configuration\n\u00b6\n\n\n\n\nle fichier de configuration est le fichier \nmy.cnf\n qui se trouve habituellement dans \n/etc/mysql/\n sinon dans \n/etc/mysql/mariadb.conf.d\n pour mariaDB\n\n\n\n\nGrandes lignes my.cnf\n\u00b6\n\n\n\n\nle port d'\u00e9coute de \nMySQLd\n : \n3306\n\n\ndiff\u00e9rents dossiers utilis\u00e9s par \nMySQLd\n\n\nle nom d'utilisateur des processus de \nMySQLd\n (qui est \nmysql\n)\n\n\ndes param\u00e8tres li\u00e9s \u00e0 la performance (taille m\u00e9moire allou\u00e9e, taille du cache ...)\n\n\nles fichiers de log \n\n\n\n\nFichier de log\n\u00b6\n\n\nDans my.cnf d\u00e9commenter :\n\n\n\n\ngeneral_log_file = /var/log/mysql/mysql.log\n\n\ngeneral_log = 1\n\n\n\n\n\n\nWarning\n\n\nlogs tr\u00e8s utiles mais consommateurs de ressources \n tueurs de perfs.\nNe pas hesiter \u00e0 les activer pour du test mais d\u00e9sactiver en production !\n\n\n\n\nChanger le r\u00e9pertoire de logs MyQSL\n\u00b6\n\n\n\n\nN\u00e9cessaire si trop d'IO sur le disque (log + datas)\n\n\n\n\nmy.cnf : \n\n\n\n\nlog-bin=/'chemindunouveaur\u00e9pertoire'/mysql-bin\n \n\n\n\n\n\n\nInfo\n\n\nPurger un maximum de logs (PURGE BINLOG...) pour ne pas avoir trop de fichiers \u00e0 transf\u00e9rer.\n\n\n\n\nArr\u00eater le service\n \n\n\nservice mysql stop\n\n\n\n\nD\u00e9placer les fichiers vers le nouveau r\u00e9pertoire\n \n\n\nmv /var/lib/mysql /mysql-bin.* /chemindunouveaur\u00e9pertoire/mysql-bin\n\n\n\n\nRed\u00e9marrer le service\n\n\n service mysql start\n\n\n\n\nLa directive bind-address\n\u00b6\n\n\n\n\nCette directive sert \u00e0 restreindre l'acc\u00e8s au service MySQLd. Seule la machine (et donc les logiciels outils install\u00e9s dessus) indiqu\u00e9e dans cette directive peut acc\u00e9der au service.\n\n\n\n\nSi on veut acc\u00e9der que par la machine local (localhost) :\n\n\nbind-address \n=\n \n127\n.0.0.1\n\n\n\n\nSi on veut uniquement un serveur distant :\n \n\n\nbind-address \n=\n \n\"ip du serveur\"\n\n\n\n\n\nSi on veut ouvrir \u00e0 tous les serveurs :\n \n\n\nbind-address \n=\n \n0\n.0.0.0\n\n\n\n\n\n\nInfo\n\n\nIl n'y a pas de demie mesure, la s\u00e9curisation doit se faire en amont pour les serveur de donn\u00e9es.\n\n\n\n\nS\u00e9curisation du service MySQL\n\u00b6\n\n\nmysql_secure_installation\n\n\n\n\nCela permet de :\n \n\n\n\n\ns'assurer de bien avoir un mot de passe root MySQL \n\n\nemp\u00eacher d'acc\u00e9der en root MySQL depuis le r\u00e9seau (par le socket MySQL ; par contre on acc\u00e8de \u00e0 distance par SSH et ensuite on se connecte \u00e0 SQL une fois rentr\u00e9 dans la machine donc en \u00ab local \u00bb.\n\n\nemp\u00eacher les connexions anonymes\n\n\nsupprimer la base de test (accessible par d\u00e9faut par tous, m\u00eame anonymes) et les privil\u00e8ges qui autorisent tout le monde \u00e0 acc\u00e9der \u00e0 toutes les bases commen\u00e7ant par test_\n\n\n\n\nCommandes MySQL (base)\n\u00b6\n\n\nSe connecter\n\n\nmysql -h \n'host '\n-u \n'user'\n -p \n\n\n\n\n\n\n-h\n premet de pr\u00e9ciser l'h\u00f4te (host)\n\n\n-u\n permet de pr\u00e9ciser l'utilisateur (user)\n\n\n-p\n indique que nous allons ensuite taper le mot de passe (password)\n\n\n\n\nLister les bases\n\n\nSHOW\n \nDATABASES\n;\n\n\n\n\n\nSelectionner une base\n\n\nUSE\n \n\"nom de la bdd\"\n;\n\n\n\n\n\nLister les tables d'une base\n\n\n\n\nsi base selectionn\u00e9\n\n\n\n\nSHOW\n \nTABLES\n;\n\n\n\n\n\n\n\nsinon\n\n\n\n\nSHOW\n \nTABLES\n \nFROM\n \n\"nom de la bdd\"\n;\n\n\n\n\nCr\u00e9er une base\n \n\n\nCREATE\n \nDATABASE\n \n\"nom bdd\"\n;\n\n\n\n\n\nCr\u00e9er un utilisateur\n \n\n\nCREATE\n \nUSER\n \n'user'\n@\n'localhost'\n;\n\n\n\n\n\nAffecter une mot de passe \u00e0 un utilisateur\n\n\nSET\n \nPASSWORD\n \nFOR\n \n'user'\n \n=\n \nPASSWORD\n(\n'mot de passe'\n);\n\n\n\n\n\nDonner tout les droits \u00e0 un utilisateur sur un BD (voir \"Les privil\u00e8ges\" pour les types de droits)\n\n\nGRANT\n \nALL\n \nPRIVILEGES\n \nON\n \n'BASE.*'\n \nTO\n \nuser\n@\nlocalhost\n \nIDENTIFIED\n \nby\n \n'mot de passe'\n;\n\n\n\n\n\nRevoquer les droits d'un utilisateur\n\n\nREVOKE\n \nALL\n \nPRIVILEGES\n \nON\n \n'BASE.*'\n \nFROM\n \nuser\n;\n\n\n\n\n\nSupprimer un compte utilisateur\n\n\nDROP\n \nuser\n \n'test'\n@\n'localhost'\n;\n\n\n\n\n\nLes privil\u00e8ges (droits)\n\u00b6\n\n\n\n\nInfo\n\n\nEn mati\u00e8re de bases de donn\u00e9es, on parle de \nprivil\u00e8ges\n pour parler des \ndroits\n. Ces privil\u00e8ges s'appliquent \u00e0 des comptes. Tel compte \u00e0 le droit de faire telle action.\n\n\n\n\nLes information des utilisateurs et des privil\u00e8ges sont stock\u00e9es dans la base de donn\u00e9es mysql :\n\n\n\n\ntable user \u27a1\ufe0f utilisateurs (privil\u00e8ges globaux) \n\n\n\n\nQuatre tables pour stocker les privil\u00e8ges users\n\u00b6\n\n\n\n\ndb\n : privil\u00e8ges au niveau des bases de donn\u00e9es. \n\n\ntables_priv\n : privil\u00e8ges au niveau des tables. \n\n\ncolumns_priv\n : privil\u00e8ges au niveau des colonnes. \n\n\nprocs_priv\n : privil\u00e8ges au niveau des routines (proc\u00e9dures et fonctions stock\u00e9es).\n\n\n\n\nDroits principaux\n\u00b6\n\n\n\n\nGRANT\n : le droit de donner des droits\n\n\nCREATE\n : Cr\u00e9er des utilisateurs, des bases, des tables ou des index\n\n\nDROP\n : Supprimer des utilisateurs, des bases, des tables ou des index\n\n\nALTER\n : modifier la structure de tables\n\n\nDELETE\n : Supprimer des donn\u00e9es\n\n\nINSERT\n : Ajouter des donn\u00e9es\n\n\nUPDATE\n : Modifier des donn\u00e9es\n\n\n\n\n\n\nExample\n\n\n\n\nAjouter le droit de faire un INSERT sur la table \u00ab table1 \u00bb pour l\u2019utilisateur \u201cinvite\u201d : \n\n\n\n\nGRANT\n \nINSERT\n \nON\n \ntable1\n \nTO\n \ninvite\n;\n\n\n\n\n\n\n\nAttribuer tous les droits \u00e0 l\u2019utilisateur \u201cinvite\u201d sur la base de donn\u00e9es utilis\u00e9e : \n\n\n\n\nGRANT\n \nALL\n \nON\n \n*\n \nTO\n \ninvite\n;\n\n\n\n\n\n\n\nRetirer le droit de faire un INSERT sur toutes les tables de la BDD utilis\u00e9e pour l\u2019utilisateur \u00ab invite \u00bb :\n\n\n\n\nREVOKE\n \nINSERT\n \nON\n \n*\n \nFROM\n \ninvite\n;\n\n\n\n\n\n\n\nRetirer le droit de faire un INSERT sur la table \u00ab table1 \u00bb pour l\u2019utilisateur \u201cinvite\u201d : \n\n\n\n\nREVOKE\n \nINSERT\n \nON\n \ntable1\n \nFROM\n \ninvite\n;\n\n\n\n\n\n\n\nRetirer tous les droits \u00e0 l\u2019utilisateur \u201cinvite\u201d sur toutes les tables de la BDD utilis\u00e9e : \n\n\n\n\nREVOKE\n \nALL\n \nPRIVILEGES\n \nON\n \n*\n \nFROM\n \ninvite\n\n\n\n\n\n\n\n\n\nDanger\n\n\nne jamais donner \nWITH GRANT OPTION\n \u00e0 un utilisateur non         administrateur syst\u00e8me \n\n\n\n\nSupervision\n\u00b6\n\n\nMySQLTuner\n\u00b6\n\n\n\n\nScript \nPERL\n qui permet d'optimiser les performances d'un serveur de bases de donn\u00e9es MySQL en faisant un diagnostic, voir: \nhttps://github.com/major/MySQLTuner-perl\n\n\n\n\nMytop\n\u00b6\n\n\n\n\nOutil \"top like\" \u00e9crit en PERL mais pour les base de donn\u00e9es. (int\u00e9gr\u00e9 \u00e0 deb9)\n\n\n\n\nutilisation\n \n\n\nmytop --prompt -d \n\"base de donn\u00e9e\"\n\n\n\n\n\nSi cela ne fonctionne pas , installer les d\u00e9pendances PERL suivante :\n\n\n apt-get install libconfig-inifiles-perl\n\n\n\n\nMysql only :\n\n\nfichier de confg d'exemple dans /usr/share /doc/mysql-server-5.X.XX\n\n\nTuning\n\u00b6\n\n\nkey_buffer\n \n\n\nSHOW\n \nGLOBAL\n \nSTATUS\n\n\n\n\n\nligne \nkey_reads/key_read_requests\n radio < 0.01 pour \u00e9viter acc\u00e8s disque \n\n\nsinon augmenter le \nkey_buffer\n\n\nthread_concurrency (machine multicoeur)\n\n\nValeur \u00e0 x2 nombre de coeurs\n\n\nActiver le log des requ\u00eates lentes\n \n\n\nslow_query_log=1\n \n\n\nslow_query_log_file=/var/log/mysql/mysql-slow.log\n \n\n\nEt demander d'indiquer le temps le plus lent\n\n\nlong_query_time = 2\n \n\n\nAnalyser les r\u00e9sultats\n\n\ntail -n \n1000\n /var/log/mysql/mysql-slow.log \n\n\n\ncheck \"connection leakage\"\n\n\nSHOW\n \nPROCESSLIST\n;\n\n\n\n\nAnalyser les verrous\n\n\nSHOW\n \nSTATUS\n \nLIKE\n \n'Table%'\n;\n\n\nSHOW\n \nENGINE\n \nINNODB\n \nSTATUS\n \n(\npour\n \ninnodb\n)\n\n\n\n\n\nSauvegarde\n\u00b6\n\n\nmysqldump (\u00e0 chaud)\n\u00b6\n\n\nbases pr\u00e9cises\n\n\n mysqldump --user\n=\nroot -p --databases mysql wiki > wiki_bd_backup.sql\n\n\n\nall base\n\n\nmysqldump --user\n=\nroot -p --all-databases \n|\n gzip > save.mysql.sql.gz\n\n\n\n\nbackup \u00e0 froid :\n\u00b6\n\n\n\n\nElle consiste \u00e0 sauvegarder les fichiers \u201cphysiques\u201d du serveur de donn\u00e9es. Elle n\u00e9cessite, par d\u00e9finition l\u2019arr\u00eat du serveur. \n\n\n\n\nAucune activit\u00e9 n\u2019est donc possible. C\u2019est un avantage pour le DBA mais il est parfois difficile voire impossible de stopper l\u2019activit\u00e9 en cours. En revanche si l\u2019on dispose d\u2019un r\u00e9plica on peut tout \u00e0 fait l\u2019envisager. Celui ci se \u201cre synchronisera\u201d \u00e0 son red\u00e9marrage. La sauvegarde \u00e0 froid consiste \u00e0 archiver certains fichiers du serveur\n**/var/lib/mysql/**\n et \n**/var/log/mysql.log**\n \n\n\nPour les tables MyISAM il s\u2019agit plus pr\u00e9cisement des fichiers \n.FRM\n, \n.MYI\n et \n.MYD\n. Pour les tables InnoDB : \n.FRM\n, les fichiers de donn\u00e9es (ibdata), les fichiers des tables .ibd (si vous \u00eates en innodb_file_per_table) et les fichiers journaux (iblogfile) interm\u00e9diaires.\n\n\nRestauration\n\u00b6\n\n\ndump en selectionnant la base\n\n\nuse\n \ndatabase\n;\n\n\nsource\n \n/\nchemin\n/\ndu\n/\nfichier\n/\nbackup\n.\nsql\n\n\n\n\n\nou pour le scripting\n \n\n\nmysql -u myuser -p < /chemin/du/fichier/backup.sql \n(\n automatisation totale avec --password \n=\n < mot de passe >\n\n\n\n\n\n\nInfo\n\n\npour restaurer \u00e0 froid, il suffit de couper le service et de d\u00e9poser les fichiers aux bons emplacements\n\n\n\n\nAutomatisation des sauvegardes\n\u00b6\n\n\nautomysqlbackup, Script \"tout en un\"\n\n\n\n\nNotification par mail\n\n\nCompression et chiffrement des sauvegardes\n\n\nRotation des sauvegardes configurable \n\n\nSauvegardes incr\u00e9mentales\n\n\n\n\napt-get install automysqlbackup\n\n\n\n\n\u00e0 configure dans  \n/etc/default/automysqlbackup\n\n\nrsnapshot\n\n\napt-get install rsnapshot\n\n\n\n\nvoir \nhttps://wiki.debian-fr.xyz/Rsnapshot\n\n\noutil de backup \u00e0 chaud\n\n\n\n\nhttps://www.percona.com/doc/percona-xtrabackup/LATEST/index.html\n\n\n\n\nMigration Mysql vers MariaDB (deb<9)\n\u00b6\n\n\nMaj du serveur Debian\n\n\napt-get update \n&&\n apt-get upgrade\napt-get install python-software-properties software-properties-common\n\n\n\nAjout des d\u00e9pot MariaDB voir\n \n\n\n\n\nhttps://downloads.mariadb.org/mariadb/repositories/\n\n\n\n\nupdate des paquets et installe\n\n\napt-get update \n&&\n apt-get install mariadb-server\n\n\n\n\n\n\nInfo\n\n\nSi Mysql > 5.5 migration directement sur 10.1 sinon 5.5\n\n\n\n\nCluser MariaDB/Galera\n\u00b6\n\n\n\n\nCluster synchro en ma\u00eetre-ma\u00eetre\n\n\n\n\n\n\nInfo\n\n\nEn production favoriser 3 serveurs minimum\n\n\n\n\nCr\u00e9ation du cluster\n\n\nservice mysql stop\nmysqld --wsrep-new-cluster\n\n#or\n\ngalera_new_cluster\n\n\nsur les autres noeuds\n\n\nservice mysql stop\nmysqld --wsrep_cluster_address\n=\ngcomm://ip\n(\nou nom DNS du serveur qui a cr\u00e9\u00e9 le cluster\n)\n\n\n\n\nvoir le statut de la syncrho\n\n\nSHOW\n \nSTATUS\n \nLIKE\n \n'wsrep_%'\n\n\n\n\n\n\n\nTip\n\n\nconfiguration affin\u00e9e voir \nhttp://www.severalnines.com/New-Galera-Configurator/index.html\n\n\n\n\nTroubleshoot\n\u00b6\n\n\nTable corrompue\n\u00b6\n\n\nMessage d'erreur\n \n\n\n\n\n\u201cTable is marked as crashed and should be repaired\u201d \n\n\n\n\nSolution\n\n\nrepair\n \ntable\n \nbd\n.\ntablename\n;\n\n\n\n\n\nR\u00e9cup\u00e9ration de mot de passe root MySQL\n\u00b6\n\n\narr\u00eat du service et red\u00e9marrage en mode rescue\n\n\nsystemctl stop mysql \n&&\n mysqld_safe --skip-grant-tables \n&\n \n\n\n\n\nConnexion en root\n \n\n\nmysql -u root\n\n\n\ndans la console mysql\n\n\n#select base\n\n\nmysql\n>\n \nuse\n \nmysql\n;\n \n\n#change password\n\n\nmysql\n>\n \nupdate\n \nuser\n \nset\n \npassword\n=\nPASSWORD\n(\n\"nouveaumotdepasse\"\n)\n \nwhere\n \nuser\n=\n'root'\n;\n \n\n#save\n\n\nmysql\n>\n \nflush\n \nprivileges\n;\n \n\n#leave\n\n\nmysql\n>\n \nquit\n \n\n\n\narr\u00eat du mode rescue\n\n\nsystemctl stop mysql\n\n\n\n\ntest de connexion\n\n\nmysql -u root -p",
            "title": "MYSQL"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#mysql",
            "text": "",
            "title": "MYSQL"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#le-fichier-de-configuration",
            "text": "le fichier de configuration est le fichier  my.cnf  qui se trouve habituellement dans  /etc/mysql/  sinon dans  /etc/mysql/mariadb.conf.d  pour mariaDB",
            "title": "Le fichier de configuration"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#grandes-lignes-mycnf",
            "text": "le port d'\u00e9coute de  MySQLd  :  3306  diff\u00e9rents dossiers utilis\u00e9s par  MySQLd  le nom d'utilisateur des processus de  MySQLd  (qui est  mysql )  des param\u00e8tres li\u00e9s \u00e0 la performance (taille m\u00e9moire allou\u00e9e, taille du cache ...)  les fichiers de log",
            "title": "Grandes lignes my.cnf"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#fichier-de-log",
            "text": "Dans my.cnf d\u00e9commenter :   general_log_file = /var/log/mysql/mysql.log  general_log = 1    Warning  logs tr\u00e8s utiles mais consommateurs de ressources   tueurs de perfs.\nNe pas hesiter \u00e0 les activer pour du test mais d\u00e9sactiver en production !",
            "title": "Fichier de log"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#changer-le-repertoire-de-logs-myqsl",
            "text": "N\u00e9cessaire si trop d'IO sur le disque (log + datas)   my.cnf :    log-bin=/'chemindunouveaur\u00e9pertoire'/mysql-bin      Info  Purger un maximum de logs (PURGE BINLOG...) pour ne pas avoir trop de fichiers \u00e0 transf\u00e9rer.   Arr\u00eater le service    service mysql stop  D\u00e9placer les fichiers vers le nouveau r\u00e9pertoire    mv /var/lib/mysql /mysql-bin.* /chemindunouveaur\u00e9pertoire/mysql-bin  Red\u00e9marrer le service   service mysql start",
            "title": "Changer le r\u00e9pertoire de logs MyQSL"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#la-directive-bind-address",
            "text": "Cette directive sert \u00e0 restreindre l'acc\u00e8s au service MySQLd. Seule la machine (et donc les logiciels outils install\u00e9s dessus) indiqu\u00e9e dans cette directive peut acc\u00e9der au service.   Si on veut acc\u00e9der que par la machine local (localhost) :  bind-address  =   127 .0.0.1  Si on veut uniquement un serveur distant :    bind-address  =   \"ip du serveur\"   Si on veut ouvrir \u00e0 tous les serveurs :    bind-address  =   0 .0.0.0   Info  Il n'y a pas de demie mesure, la s\u00e9curisation doit se faire en amont pour les serveur de donn\u00e9es.",
            "title": "La directive bind-address"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#securisation-du-service-mysql",
            "text": "mysql_secure_installation  Cela permet de :     s'assurer de bien avoir un mot de passe root MySQL   emp\u00eacher d'acc\u00e9der en root MySQL depuis le r\u00e9seau (par le socket MySQL ; par contre on acc\u00e8de \u00e0 distance par SSH et ensuite on se connecte \u00e0 SQL une fois rentr\u00e9 dans la machine donc en \u00ab local \u00bb.  emp\u00eacher les connexions anonymes  supprimer la base de test (accessible par d\u00e9faut par tous, m\u00eame anonymes) et les privil\u00e8ges qui autorisent tout le monde \u00e0 acc\u00e9der \u00e0 toutes les bases commen\u00e7ant par test_",
            "title": "S\u00e9curisation du service MySQL"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#commandes-mysql-base",
            "text": "Se connecter  mysql -h  'host ' -u  'user'  -p    -h  premet de pr\u00e9ciser l'h\u00f4te (host)  -u  permet de pr\u00e9ciser l'utilisateur (user)  -p  indique que nous allons ensuite taper le mot de passe (password)   Lister les bases  SHOW   DATABASES ;   Selectionner une base  USE   \"nom de la bdd\" ;   Lister les tables d'une base   si base selectionn\u00e9   SHOW   TABLES ;    sinon   SHOW   TABLES   FROM   \"nom de la bdd\" ;   Cr\u00e9er une base    CREATE   DATABASE   \"nom bdd\" ;   Cr\u00e9er un utilisateur    CREATE   USER   'user' @ 'localhost' ;   Affecter une mot de passe \u00e0 un utilisateur  SET   PASSWORD   FOR   'user'   =   PASSWORD ( 'mot de passe' );   Donner tout les droits \u00e0 un utilisateur sur un BD (voir \"Les privil\u00e8ges\" pour les types de droits)  GRANT   ALL   PRIVILEGES   ON   'BASE.*'   TO   user @ localhost   IDENTIFIED   by   'mot de passe' ;   Revoquer les droits d'un utilisateur  REVOKE   ALL   PRIVILEGES   ON   'BASE.*'   FROM   user ;   Supprimer un compte utilisateur  DROP   user   'test' @ 'localhost' ;",
            "title": "Commandes MySQL (base)"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#les-privileges-droits",
            "text": "Info  En mati\u00e8re de bases de donn\u00e9es, on parle de  privil\u00e8ges  pour parler des  droits . Ces privil\u00e8ges s'appliquent \u00e0 des comptes. Tel compte \u00e0 le droit de faire telle action.   Les information des utilisateurs et des privil\u00e8ges sont stock\u00e9es dans la base de donn\u00e9es mysql :   table user \u27a1\ufe0f utilisateurs (privil\u00e8ges globaux)",
            "title": "Les privil\u00e8ges (droits)"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#quatre-tables-pour-stocker-les-privileges-users",
            "text": "db  : privil\u00e8ges au niveau des bases de donn\u00e9es.   tables_priv  : privil\u00e8ges au niveau des tables.   columns_priv  : privil\u00e8ges au niveau des colonnes.   procs_priv  : privil\u00e8ges au niveau des routines (proc\u00e9dures et fonctions stock\u00e9es).",
            "title": "Quatre tables pour stocker les privil\u00e8ges users"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#droits-principaux",
            "text": "GRANT  : le droit de donner des droits  CREATE  : Cr\u00e9er des utilisateurs, des bases, des tables ou des index  DROP  : Supprimer des utilisateurs, des bases, des tables ou des index  ALTER  : modifier la structure de tables  DELETE  : Supprimer des donn\u00e9es  INSERT  : Ajouter des donn\u00e9es  UPDATE  : Modifier des donn\u00e9es    Example   Ajouter le droit de faire un INSERT sur la table \u00ab table1 \u00bb pour l\u2019utilisateur \u201cinvite\u201d :    GRANT   INSERT   ON   table1   TO   invite ;    Attribuer tous les droits \u00e0 l\u2019utilisateur \u201cinvite\u201d sur la base de donn\u00e9es utilis\u00e9e :    GRANT   ALL   ON   *   TO   invite ;    Retirer le droit de faire un INSERT sur toutes les tables de la BDD utilis\u00e9e pour l\u2019utilisateur \u00ab invite \u00bb :   REVOKE   INSERT   ON   *   FROM   invite ;    Retirer le droit de faire un INSERT sur la table \u00ab table1 \u00bb pour l\u2019utilisateur \u201cinvite\u201d :    REVOKE   INSERT   ON   table1   FROM   invite ;    Retirer tous les droits \u00e0 l\u2019utilisateur \u201cinvite\u201d sur toutes les tables de la BDD utilis\u00e9e :    REVOKE   ALL   PRIVILEGES   ON   *   FROM   invite     Danger  ne jamais donner  WITH GRANT OPTION  \u00e0 un utilisateur non         administrateur syst\u00e8me",
            "title": "Droits principaux"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#supervision",
            "text": "",
            "title": "Supervision"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#mysqltuner",
            "text": "Script  PERL  qui permet d'optimiser les performances d'un serveur de bases de donn\u00e9es MySQL en faisant un diagnostic, voir:  https://github.com/major/MySQLTuner-perl",
            "title": "MySQLTuner"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#mytop",
            "text": "Outil \"top like\" \u00e9crit en PERL mais pour les base de donn\u00e9es. (int\u00e9gr\u00e9 \u00e0 deb9)   utilisation    mytop --prompt -d  \"base de donn\u00e9e\"   Si cela ne fonctionne pas , installer les d\u00e9pendances PERL suivante :   apt-get install libconfig-inifiles-perl  Mysql only :  fichier de confg d'exemple dans /usr/share /doc/mysql-server-5.X.XX",
            "title": "Mytop"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#tuning",
            "text": "key_buffer    SHOW   GLOBAL   STATUS   ligne  key_reads/key_read_requests  radio < 0.01 pour \u00e9viter acc\u00e8s disque   sinon augmenter le  key_buffer  thread_concurrency (machine multicoeur)  Valeur \u00e0 x2 nombre de coeurs  Activer le log des requ\u00eates lentes    slow_query_log=1    slow_query_log_file=/var/log/mysql/mysql-slow.log    Et demander d'indiquer le temps le plus lent  long_query_time = 2    Analyser les r\u00e9sultats  tail -n  1000  /var/log/mysql/mysql-slow.log   check \"connection leakage\"  SHOW   PROCESSLIST ;   Analyser les verrous  SHOW   STATUS   LIKE   'Table%' ;  SHOW   ENGINE   INNODB   STATUS   ( pour   innodb )",
            "title": "Tuning"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#sauvegarde",
            "text": "",
            "title": "Sauvegarde"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#mysqldump-a-chaud",
            "text": "bases pr\u00e9cises   mysqldump --user = root -p --databases mysql wiki > wiki_bd_backup.sql  all base  mysqldump --user = root -p --all-databases  |  gzip > save.mysql.sql.gz",
            "title": "mysqldump (\u00e0 chaud)"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#backup-a-froid",
            "text": "Elle consiste \u00e0 sauvegarder les fichiers \u201cphysiques\u201d du serveur de donn\u00e9es. Elle n\u00e9cessite, par d\u00e9finition l\u2019arr\u00eat du serveur.    Aucune activit\u00e9 n\u2019est donc possible. C\u2019est un avantage pour le DBA mais il est parfois difficile voire impossible de stopper l\u2019activit\u00e9 en cours. En revanche si l\u2019on dispose d\u2019un r\u00e9plica on peut tout \u00e0 fait l\u2019envisager. Celui ci se \u201cre synchronisera\u201d \u00e0 son red\u00e9marrage. La sauvegarde \u00e0 froid consiste \u00e0 archiver certains fichiers du serveur **/var/lib/mysql/**  et  **/var/log/mysql.log**    Pour les tables MyISAM il s\u2019agit plus pr\u00e9cisement des fichiers  .FRM ,  .MYI  et  .MYD . Pour les tables InnoDB :  .FRM , les fichiers de donn\u00e9es (ibdata), les fichiers des tables .ibd (si vous \u00eates en innodb_file_per_table) et les fichiers journaux (iblogfile) interm\u00e9diaires.",
            "title": "backup \u00e0 froid :"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#restauration",
            "text": "dump en selectionnant la base  use   database ;  source   / chemin / du / fichier / backup . sql   ou pour le scripting    mysql -u myuser -p < /chemin/du/fichier/backup.sql  (  automatisation totale avec --password  =  < mot de passe >   Info  pour restaurer \u00e0 froid, il suffit de couper le service et de d\u00e9poser les fichiers aux bons emplacements",
            "title": "Restauration"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#automatisation-des-sauvegardes",
            "text": "automysqlbackup, Script \"tout en un\"   Notification par mail  Compression et chiffrement des sauvegardes  Rotation des sauvegardes configurable   Sauvegardes incr\u00e9mentales   apt-get install automysqlbackup  \u00e0 configure dans   /etc/default/automysqlbackup  rsnapshot  apt-get install rsnapshot  voir  https://wiki.debian-fr.xyz/Rsnapshot  outil de backup \u00e0 chaud   https://www.percona.com/doc/percona-xtrabackup/LATEST/index.html",
            "title": "Automatisation des sauvegardes"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#migration-mysql-vers-mariadb-deb9",
            "text": "Maj du serveur Debian  apt-get update  &&  apt-get upgrade\napt-get install python-software-properties software-properties-common  Ajout des d\u00e9pot MariaDB voir     https://downloads.mariadb.org/mariadb/repositories/   update des paquets et installe  apt-get update  &&  apt-get install mariadb-server   Info  Si Mysql > 5.5 migration directement sur 10.1 sinon 5.5",
            "title": "Migration Mysql vers MariaDB (deb&lt;9)"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#cluser-mariadbgalera",
            "text": "Cluster synchro en ma\u00eetre-ma\u00eetre    Info  En production favoriser 3 serveurs minimum   Cr\u00e9ation du cluster  service mysql stop\nmysqld --wsrep-new-cluster #or \ngalera_new_cluster \nsur les autres noeuds  service mysql stop\nmysqld --wsrep_cluster_address = gcomm://ip ( ou nom DNS du serveur qui a cr\u00e9\u00e9 le cluster )   voir le statut de la syncrho  SHOW   STATUS   LIKE   'wsrep_%'    Tip  configuration affin\u00e9e voir  http://www.severalnines.com/New-Galera-Configurator/index.html",
            "title": "Cluser MariaDB/Galera"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#troubleshoot",
            "text": "",
            "title": "Troubleshoot"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#table-corrompue",
            "text": "Message d'erreur     \u201cTable is marked as crashed and should be repaired\u201d    Solution  repair   table   bd . tablename ;",
            "title": "Table corrompue"
        },
        {
            "location": "/AdminSys/BDD/MySQL/#recuperation-de-mot-de-passe-root-mysql",
            "text": "arr\u00eat du service et red\u00e9marrage en mode rescue  systemctl stop mysql  &&  mysqld_safe --skip-grant-tables  &    Connexion en root    mysql -u root  dans la console mysql  #select base  mysql >   use   mysql ;   #change password  mysql >   update   user   set   password = PASSWORD ( \"nouveaumotdepasse\" )   where   user = 'root' ;   #save  mysql >   flush   privileges ;   #leave  mysql >   quit    arr\u00eat du mode rescue  systemctl stop mysql  test de connexion  mysql -u root -p",
            "title": "R\u00e9cup\u00e9ration de mot de passe root MySQL"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/",
            "text": "PostgreSQL\n\u00b6\n\n\n\u2139\ufe0f pour l'installation chercher LAMP\n\n\nCommande\n\u00b6\n\n\n\n\nModifier le mot de passe de l'utilisateur syst\u00e8me postgres \n\n\n\n\npasswd postgres\n\n\n\n\n\n\nModifier le mot de passe de l'utilisateur administrateur de la base postgres \n\n\n\n\nsu - postgres\npsql -d template1 -c \n\"ALTER USER postgres WITH PASSWORD 'mot de passe'\"\n\n\n\n\n\nou\n\n\npsql\n\npostgres\n=\n# \\password postgres\n\n\n\n\n\n\n\nCr\u00e9er une base \n\n\n\n\nsu - postgres\ncreatedb \n\"nom de la base\"\n\n\n\n\n\n\n\nSe connecter \u00e0 une base\n\n\n\n\npsql \n\"nom de la base\"\n\n\n\n\n\n\n\nhelp\n\n\n\n\n\\h\n\n\n\n\n\n\nfermer la connexion\n\n\n\n\n\\q\n\n\n\n\n\n\n\nCr\u00e9er un utilisateur \n\n\n\n\npsql -d template1 -c \n\"create user \"\nnom de l\n'user\" with password '\nmotdepasse\n'\n\"\n\n\n\n\n\n\n\nPour g\u00e9rer la base \u00e0 distance\n\n\n\n\nsu - postgres\npsql template1 < /usr/share/postgresql/9.6/extension/adminpack--1.0.sql\n\nexit\n\n\n\n\n\nou\n\n\npostgres\n=\n# CREATE EXTENSION adminpack;\n\nCREATE EXTENSION\n\n\n\n\n\n\nActivation des connexion TCP/IP \n\n\n\n\nvim /etc/postgresql/9.6/main/postgresql.conf\n  \nlisten_addresses\n \n=\n \n'localhost'\n\n  \npassword_encryption\n \n=\n on\n\nservice postgresql restart\n\n\n\n\nAdministration web (voir section LAMP pour l'installation) :\n\u00b6\n\n\napt-get install phppgadmin\n\n\n\n\n\n\nmodifier /etc/apache2/conf-available/phppgadmin.conf pour les acc\u00e8s\n\n\n\n\nln /etc/apache2/conf-available/phppgadmin.conf /etc/apache2/sites-available/.\na2ensite phppgadmin.conf\n\n\n\n\n\n\nrestart des services  apache2 et postresql et connexion au site http://ipduserv/phppgadmin\n\n\n\n\nR\u00e9plication \"streaming\" PostgresSQL\n\u00b6\n\n\nPr\u00e9requis\n\u00b6\n\n\n2 serveurs avec PostgreSQL (ma\u00eetre et esclave\n\n\n\n\n\n\nServeur ma\u00eetre :\n\u00b6\n\n\n\n\n\n\nvim /etc/postgresql/9.6/main/postgresql.conf     \n  \nlisten_addresse\n \n=\n \n'*'\n\n  \nwal_level\n \n=\n hot_standby \nwal_keep_segments\n \n=\n \n10\n\n  \nmax_wal_senders\n \n=\n \n3\n\n\n\n\n\n\n\nUser pour la r\u00e9plication\n\n\n\n\npsql -h localhost -U postgres -W -c CREATE USER utilrepl WITH REPLICATION PASSWORD \n'motdepasse'\n;\n\"\n\n\n\n\n\n\n\nDroit de connexion pour l'user de r\u00e9plication\n\n\n\n\nvim /etc/postgresql/9.6/main/pg_hba.conf \nhost    replication     utilrepl        ip esclave/cidr          md5\n\n\n\n\n\n\nOn arr\u00eate de le service\n\n\n\n\nservice postgresql stop\n\n\n\n\n\n\n\n\nServer escalve :\n\u00b6\n\n\n\n\n\n\nvim /etc/postgresql/9.6/main/postgresql.conf\n\nlisten_addresses\n \n=\n \n'*'\n \n\nhot_standby\n \n=\n on\n\n\n\n\n\n\nOn arr\u00eate l'esclave et on d\u00e9truit tous les fichiers de la base\n\n\n\n\n/etc/init.d/postgresql stop \n\ncd\n /var/lib/postgresql/9.6/main/ \nrm -rf * \nvim /var/lib/postgresql/9.6/main/recovery.conf \n\nprimary_conninfo\n \n=\n \n'host=serveur ma\u00eetre port=5432 user=utilrepl password=motdepasse'\n \n\nstandby_mode\n \n=\n on\n\n\n\n\n\n\nOn copie tout du ma\u00eetre vers l'esclave\n\n\n\n\nrsync -av /var/lib/postgresql/9.6/main/* ip esclave:/var/lib/postgresql/9.6/main/\n\n\n\n\n\n\nRed\u00e9marrer les services sur les deux serveurs\n\n\n\n\nservice postgresql start\n\n\n\n\n\n\ncheck de la r\u00e9plication\n\n\n\n\npsql -h localhost -U postgres -W -c \n\"select * from pg_stat_replication;\"\n\n\n\n\n\nTroubleshoot\n\u00b6\n\n\nR\u00e9cup\u00e9ration de mot de passe oubli\u00e9\n\u00b6\n\n\n\n\nArr\u00eat du service\n\n\n\n\nservice postgresql stop\n\n\n\n\n\n\nmodification de pg_hba.conf\n\n\n\n\nvim /usr/lib/pgsql/data/pg_hba.conf\n  \nlocal\n all all ...\n\n#modifier en : \n\n  \nlocal\n all postgres trust\n\n\n\n\n\n\nRelancer le service et changer le mdp \n\n\n\n\nservice postgresql start \nsu - postgres $ psql -d template1 -U postgres \nalter user postgres with password \n'votrenouveaumotdepasse'\n;\n\n\n#version une commande\n\n psql -U postgres template1 -c \n\"alter user postgres with password 'votrenouveaumotdepasse';\"\n\n\n\n\n\n\n\nRemodifier pg_hba.conf pour avoir \"local all postgres ident\" et relancer le service !\n\n\n\n\nTuning\n\u00b6\n\n\n\n\nvoir \nhttps://www.dsfc.net/logiciel-libre/postgresql/tuning-postgresql-configuration-memoire-linux/\n\n\n\n\nBackup\n\u00b6\n\n\n\n\nVoir section mysql sinon : \n\n\nhttp://www.pgbarman.org/",
            "title": "PostgreSQL"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/#postgresql",
            "text": "\u2139\ufe0f pour l'installation chercher LAMP",
            "title": "PostgreSQL"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/#commande",
            "text": "Modifier le mot de passe de l'utilisateur syst\u00e8me postgres    passwd postgres   Modifier le mot de passe de l'utilisateur administrateur de la base postgres    su - postgres\npsql -d template1 -c  \"ALTER USER postgres WITH PASSWORD 'mot de passe'\"   ou  psql postgres = # \\password postgres    Cr\u00e9er une base    su - postgres\ncreatedb  \"nom de la base\"    Se connecter \u00e0 une base   psql  \"nom de la base\"    help   \\h   fermer la connexion   \\q    Cr\u00e9er un utilisateur    psql -d template1 -c  \"create user \" nom de l 'user\" with password ' motdepasse ' \"    Pour g\u00e9rer la base \u00e0 distance   su - postgres\npsql template1 < /usr/share/postgresql/9.6/extension/adminpack--1.0.sql exit   ou  postgres = # CREATE EXTENSION adminpack; \nCREATE EXTENSION   Activation des connexion TCP/IP    vim /etc/postgresql/9.6/main/postgresql.conf\n   listen_addresses   =   'localhost' \n   password_encryption   =  on\n\nservice postgresql restart",
            "title": "Commande"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/#administration-web-voir-section-lamp-pour-linstallation",
            "text": "apt-get install phppgadmin   modifier /etc/apache2/conf-available/phppgadmin.conf pour les acc\u00e8s   ln /etc/apache2/conf-available/phppgadmin.conf /etc/apache2/sites-available/.\na2ensite phppgadmin.conf   restart des services  apache2 et postresql et connexion au site http://ipduserv/phppgadmin",
            "title": "Administration web (voir section LAMP pour l'installation) :"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/#replication-streaming-postgressql",
            "text": "",
            "title": "R\u00e9plication \"streaming\" PostgresSQL"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/#prerequis",
            "text": "2 serveurs avec PostgreSQL (ma\u00eetre et esclave",
            "title": "Pr\u00e9requis"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/#serveur-maitre",
            "text": "vim /etc/postgresql/9.6/main/postgresql.conf     \n   listen_addresse   =   '*' \n   wal_level   =  hot_standby  wal_keep_segments   =   10 \n   max_wal_senders   =   3    User pour la r\u00e9plication   psql -h localhost -U postgres -W -c CREATE USER utilrepl WITH REPLICATION PASSWORD  'motdepasse' ; \"    Droit de connexion pour l'user de r\u00e9plication   vim /etc/postgresql/9.6/main/pg_hba.conf \nhost    replication     utilrepl        ip esclave/cidr          md5   On arr\u00eate de le service   service postgresql stop",
            "title": "Serveur ma\u00eetre :"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/#server-escalve",
            "text": "vim /etc/postgresql/9.6/main/postgresql.conf listen_addresses   =   '*'   hot_standby   =  on   On arr\u00eate l'esclave et on d\u00e9truit tous les fichiers de la base   /etc/init.d/postgresql stop  cd  /var/lib/postgresql/9.6/main/ \nrm -rf * \nvim /var/lib/postgresql/9.6/main/recovery.conf  primary_conninfo   =   'host=serveur ma\u00eetre port=5432 user=utilrepl password=motdepasse'   standby_mode   =  on   On copie tout du ma\u00eetre vers l'esclave   rsync -av /var/lib/postgresql/9.6/main/* ip esclave:/var/lib/postgresql/9.6/main/   Red\u00e9marrer les services sur les deux serveurs   service postgresql start   check de la r\u00e9plication   psql -h localhost -U postgres -W -c  \"select * from pg_stat_replication;\"",
            "title": "Server escalve :"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/#troubleshoot",
            "text": "",
            "title": "Troubleshoot"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/#recuperation-de-mot-de-passe-oublie",
            "text": "Arr\u00eat du service   service postgresql stop   modification de pg_hba.conf   vim /usr/lib/pgsql/data/pg_hba.conf\n   local  all all ... #modifier en :  \n   local  all postgres trust   Relancer le service et changer le mdp    service postgresql start \nsu - postgres $ psql -d template1 -U postgres \nalter user postgres with password  'votrenouveaumotdepasse' ;  #version une commande \n psql -U postgres template1 -c  \"alter user postgres with password 'votrenouveaumotdepasse';\"    Remodifier pg_hba.conf pour avoir \"local all postgres ident\" et relancer le service !",
            "title": "R\u00e9cup\u00e9ration de mot de passe oubli\u00e9"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/#tuning",
            "text": "voir  https://www.dsfc.net/logiciel-libre/postgresql/tuning-postgresql-configuration-memoire-linux/",
            "title": "Tuning"
        },
        {
            "location": "/AdminSys/BDD/PostgreSQL/#backup",
            "text": "Voir section mysql sinon :   http://www.pgbarman.org/",
            "title": "Backup"
        },
        {
            "location": "/Code/bash/",
            "text": "",
            "title": "Bash"
        },
        {
            "location": "/Code/python/",
            "text": "",
            "title": "Python"
        },
        {
            "location": "/DevOps/ansible/",
            "text": "toto",
            "title": "Ansible"
        }
    ]
}